<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><style>*{box-sizing:border-box}body{font-family:Arial,Helvetica,sans-serif}#chatlog{position:fixed;top:0;bottom:32px;left:0;right:200px;overflow-y:auto;padding:8px;overflow-wrap:break-word}#chatlog span.username{font-weight:bold}#spacer{height:calc(100vh - 32px - 5em)}#roster{font-weight:bold;padding:8px}p{margin-top:0;margin-bottom:8px}p:last-of-type{margin:0}#roster{position:fixed;right:0;top:0;bottom:32px;width:200px;border-left:none}::-webkit-scrollbar{display:none}@media(max-width:600px){#roster{display:none}#chatlog{right:0}}#chat-input{position:fixed;width:100%;height:32px;bottom:0;left:0;border:none;border-top:none;padding-left:32px;outline:none}#chatroom::before{z-index:1;display:block;content:">";position:fixed;bottom:0;left:0;width:32px;height:32px;line-height:32px;text-align:center;font-weight:bold;color:#888;-webkit-text-stroke-width:2px}#name-form{position:fixed;z-index:3;top:0;bottom:0;left:0;right:0;background-color:white}#name-input{position:fixed;font-size:200%;top:calc(50% - 1em);left:calc(50% - 8em);width:16em;height:2em;margin:0;text-align:center;border:1px solid #bbb}#name-form p{position:fixed;top:calc(50% + 3em);width:100%;text-align:center}#room-form{position:fixed;z-index:2;top:0;bottom:0;left:0;right:0;background-color:white;font-size:200%;margin-top:calc(50vh - 3em);text-align:center}#room-name{font-size:inherit;border:1px solid #bbb;height:2em;width:16em;padding-left:1em}#room-form button{font-size:inherit;border:1px solid #bbb;background-color:#eee;height:2em}@media(max-width:660px){#name-input,#room-form{font-size:150%}#name-form p{font-size:75%}}@media(max-width:500px){#name-input,#room-form{font-size:100%}#name-form p{font-size:50%}}#go-public{width:4em}#go-private{width:20em}</style></head><body><form id="name-form" action="/fake-form-action"><input id="name-input" placeholder="your name"><p>Enter your name to join the chat</p></form><form id="room-form" action="/fake-form-action"><p>Enter a public room:</p><input id="room-name" placeholder="room name"><button id="go-public">Go &raquo;</button><p>OR</p><button id="go-private">Create a Private Room &raquo;</button></form><form id="chatroom" action="/fake-form-action"><div id="chatlog"><div id="spacer"></div></div><div id="roster"></div><input id="chat-input"></form><script type="text/javascript">var _0x123a=["querySelector","value","addEventListener","input","length","slice","focus","remove","keydown","scrollBy","submit","JSON","send","text","scrollTop","clientHeight","scrollHeight","toString"];let currentWebSocket=null,nameForm=document[_0x123a[0]]("#name-form"),nameInput=document[_0x123a[0]]("#name-input"),roomForm=document[_0x123a[0]]("#room-form"),roomNameInput=document[_0x123a[0]]("#room-name"),goPublicButton=document[_0x123a[0]]("#go-public"),goPrivateButton=document[_0x123a[0]]("#go-private"),chatroom=document[_0x123a[0]]("#chatroom"),chatlog=document[_0x123a[0]]("#chatlog"),chatInput=document[_0x123a[0]]("#chat-input"),roster=document[_0x123a[0]]("#roster"),isAtBottom=!0,username,roomname,hostname=window.location.host;""===hostname&&(hostname="edge-chat-demo.cloudflareworkers.com");function startNameChooser(){nameForm[_0x123a[2]]("submit",function(_0x1a1bx2){_0x1a1bx2.preventDefault(),username=nameInput[_0x123a[1]],0<username[_0x123a[4]]&&startRoomChooser()}),nameInput[_0x123a[2]](_0x123a[3],function(_0x1a1bx2){32<_0x1a1bx2.currentTarget[_0x123a[1]]&&(_0x1a1bx2.currentTarget[_0x123a[1]]=_0x1a1bx2.currentTarget[_0x123a[1]].slice(0,32))}),nameInput[_0x123a[6]]()}function startRoomChooser(){nameForm[_0x123a[7]](),0<document.location.hash[_0x123a[4]]?(roomname=document.location.hash.slice(1),startChat()):(roomForm[_0x123a[2]]("submit",function(_0x1a1bx2){_0x1a1bx2.preventDefault(),roomname=roomNameInput[_0x123a[1]],0<roomname[_0x123a[4]]&&startChat()}),roomNameInput[_0x123a[2]](_0x123a[3],function(_0x1a1bx2){32<_0x1a1bx2.currentTarget[_0x123a[1]]&&(_0x1a1bx2.currentTarget[_0x123a[1]]=_0x1a1bx2.currentTarget[_0x123a[1]].slice(0,32))}),goPublicButton[_0x123a[2]]("click",function(_0x1a1bx2){roomname=roomNameInput[_0x123a[1]],0<roomname[_0x123a[4]]&&startChat()}),goPrivateButton[_0x123a[2]]("click",async function(_0x1a1bx2){roomNameInput.disabled=!0,goPublicButton.disabled=!0,_0x1a1bx2.currentTarget.disabled=!0;let _0x1a1bx3=await fetch("https://"+hostname+"/api/room",{method:"POST"});if(!_0x1a1bx3.ok)return alert("something went wrong"),document.location.reload(),void 0;roomname=await _0x1a1bx3[_0x123a[12]](),startChat()}),roomNameInput[_0x123a[6]]())}function startChat(){roomForm[_0x123a[7]](),roomname=roomname.replace(/[^a-zA-Z0-9_-]/g,"").replace(/_/g,"-").toLowerCase(),roomname[_0x123a[4]]>32&&!roomname.match(/^[0-9a-f]{64}$/)?addChatMessage("ERROR","Invalid room name."):(document.location.hash="#"+roomname,chatInput[_0x123a[2]]("keydown",function(_0x1a1bx2){38==_0x1a1bx2.keyCode?chatlog[_0x123a[9]](0,-50):40==_0x1a1bx2.keyCode?chatlog[_0x123a[9]](0,50):33==_0x1a1bx2.keyCode?chatlog[_0x123a[9]](0,-chatlog[_0x123a[15]]+50):34==_0x1a1bx2.keyCode&&chatlog[_0x123a[9]](0,chatlog[_0x123a[15]]-50)}),chatroom[_0x123a[2]]("submit",function(_0x1a1bx2){_0x1a1bx2.preventDefault(),currentWebSocket&&currentWebSocket[_0x123a[13]](JSON[_0x123a[11]]({message:chatInput[_0x123a[1]]})),chatInput[_0x123a[1]]="",chatlog[_0x123a[9]](0,1e8)}),chatInput[_0x123a[2]](_0x123a[3],function(_0x1a1bx2){256< _0x1a1bx2.currentTarget[_0x123a[1]][_0x123a[4]]&&(_0x1a1bx2.currentTarget[_0x123a[1]]=_0x1a1bx2.currentTarget[_0x123a[1]].slice(0,256))}),chatlog[_0x123a[2]]("scroll",function(_0x1a1bx2){isAtBottom=chatlog[_0x123a[14]]+chatlog[_0x123a[15]]>=chatlog[_0x123a[16]]}),chatInput[_0x123a[6]](),document.body[_0x123a[2]]("click",function(_0x1a1bx2){""==window.getSelection().toString()&&chatInput[_0x123a[6]]()}),"visualViewport"in window&&window.visualViewport.addEventListener("resize",function(_0x1a1bx2){isAtBottom&&chatlog[_0x123a[9]](0,1e8)}),join()}let lastSeenTimestamp=0,wroteWelcomeMessages=!1;function join(){const _0x1a1bx2=document.location.protocol==="http:"?"ws://":"wss://";let _0x1a1bx3=new WebSocket(_0x1a1bx2+hostname+"/api/room/"+roomname+"/websocket"),_0x1a1bx4=!1,_0x1a1bx5=Date.now();const _0x1a1bx6=async()=>{_0x1a1bx4||( _0x1a1bx4=!0,currentWebSocket=null);while(roster.firstChild)roster.removeChild(roster.firstChild);let _0x1a1bx7=Date.now()-_0x1a1bx5;_0x1a1bx7<1e4&&await new Promise(_0x1a1bx8=>setTimeout(_0x1a1bx8,1e4-_0x1a1bx7)),join()};_0x1a1bx3.addEventListener("open",_0x1a1bx2=>{currentWebSocket=_0x1a1bx3,_0x1a1bx3.send(JSON[_0x123a[11]]({name:username}))}),_0x1a1bx3.addEventListener("message",_0x1a1bx2=>{let _0x1a1bx3=JSON.parse(_0x1a1bx2.data);_0x1a1bx3.error?addChatMessage(null,"* Error: "+_0x1a1bx3.error):_0x1a1bx3.joined?(p=document.createElement("p"),p.innerText=_0x1a1bx3.joined,roster.appendChild(p)):_0x1a1bx3.quit&&roster.childNodes.forEach(_0x1a1bx4=>_0x1a1bx4.innerText==_0x1a1bx3.quit&&roster.removeChild(_0x1a1bx4)),_0x1a1bx3.ready&&!wroteWelcomeMessages&&(wroteWelcomeMessages=!0,["* Initializing connection…","* Connecting server node: NYC","* Establishing secure tunnel…","* Connection established! You can start chatting."].forEach((msg,idx)=>setTimeout(()=>addChatMessage(null,msg),800*idx))),_0x1a1bx3.timestamp>lastSeenTimestamp&&(addChatMessage(_0x1a1bx3.name,_0x1a1bx3.message),lastSeenTimestamp=_0x1a1bx3.timestamp)}),_0x1a1bx3.addEventListener("close",_0x1a1bx2=>{console.log("WebSocket closed, reconnecting:",_0x1a1bx2.code,_0x1a1bx2.reason),_0x1a1bx6()}),_0x1a1bx3.addEventListener("error",_0x1a1bx2=>{console.log("WebSocket error, reconnecting:",_0x1a1bx2),_0x1a1bx6()})}function addChatMessage(_0x1a1bx2,_0x1a1bx3){let p=document.createElement("p");_0x1a1bx2&&(tag=document.createElement("span"),tag.className="username",tag.innerText=_0x1a1bx2+": ",p.appendChild(tag)),p.appendChild(document.createTextNode(_0x1a1bx3)),chatlog.appendChild(p),isAtBottom&&chatlog.scrollBy(0,1e8)}startNameChooser();</script></html>
